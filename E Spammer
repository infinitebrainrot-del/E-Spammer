-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- Settings
local spamKey = Enum.KeyCode.E
local holdDuration = 0.15 -- seconds to hold each cycle
local spamming = false

-- Executor detection
local vim
pcall(function()
    vim = game:GetService("VirtualInputManager")
end)
if not vim then
    if rawget(_G, "send_key_event") then
        vim = { SendKeyEvent = _G.send_key_event }
    elseif rawget(_G, "SendKeyEvent") then
        vim = { SendKeyEvent = _G.SendKeyEvent }
    end
end

-- Function to hold key
local function sendKeyDownUp(key, holdTime)
    if vim and type(vim.SendKeyEvent) == "function" then
        pcall(function()
            vim:SendKeyEvent(true, key, false, game)
            task.wait(holdTime or 0.5)
            vim:SendKeyEvent(false, key, false, game)
        end)
        return true
    end
    return false
end

-- UI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ESpammerUI"
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Movable frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 50)
frame.Position = UDim2.new(0.5, -100, 0.5, -25)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Parent = screenGui
frame.Active = true -- allows input

-- Button (inside the frame but not touching edges)
local button = Instance.new("TextButton")
button.Size = UDim2.new(0.9, 0, 0.8, 0) -- smaller than the frame
button.Position = UDim2.new(0.05, 0, 0.1, 0) -- margin from frame edges
button.BackgroundColor3 = Color3.fromRGB(44, 120, 224)
button.TextColor3 = Color3.fromRGB(255, 255, 255)
button.Font = Enum.Font.SourceSansBold
button.TextSize = 18
button.Text = "E Spam: OFF"
button.Parent = frame

-- Dragging the frame only (not the button)
local dragging = false
local dragStart = Vector2.new()
local frameStartPos = frame.Position

frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        frameStartPos = frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(
            frameStartPos.X.Scale,
            frameStartPos.X.Offset + delta.X,
            frameStartPos.Y.Scale,
            frameStartPos.Y.Offset + delta.Y
        )
    end
end)

-- Toggle function
local function toggleSpam()
    spamming = not spamming
    button.Text = "E Spam: " .. (spamming and "ON" or "OFF")
    button.BackgroundColor3 = spamming and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(44, 120, 224)

    if spamming then
        task.spawn(function()
            while spamming do
                local ok = sendKeyDownUp(spamKey, holdDuration)
                if not ok then
                    warn("Virtual input not available in this environment.")
                    spamming = false
                    button.Text = "E Spam: OFF"
                    button.BackgroundColor3 = Color3.fromRGB(44, 120, 224)
                    break
                end
            end
        end)
    end
end

-- Button click toggle only
button.MouseButton1Click:Connect(toggleSpam)
